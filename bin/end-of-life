#!/usr/bin/env php
<?php

use Cyrosy\PhpEndOfLife\PhpEndOfLife;

$locations = [
    __DIR__ . '/../vendor/autoload.php',
    __DIR__ . '/../../vendor/autoload.php',
];

$loaded = false;

foreach ($locations as $location) {
    if (is_file($location)) {
        require_once($location);
        $loaded = true;
        break;
    }
}

if (! $loaded) {
    fwrite(STDERR, 'Unknown Autoload File Location');
    exit(254);
}

function printPhpEndOfLifeHelp($command)
{
    fwrite(STDERR,
        "PHP End of Life\n"
        . "Expose PHP EOL Life Date and Check if Version is Supported\n\n"
        . "Usage:\n"
        . ' ' . $command . "\n"
        . ' ' . $command . " 1.0.0\n"
        . ' ' . $command . " help\n"
    );

    return 2;
}

function printPhpEndOfLifeError($exception)
{
    fwrite(STDERR, $exception->getMessage() . "\n");

    return 2;
}

$version = phpversion();

if ($argc > 2) {
    exit(printPhpEndOfLifeHelp($argv[0]));
}

$version = phpversion();

if ($argc === 2) {
    if ($argv[1] === 'help') {
        exit(printPhpEndOfLifeHelp($argv[0]));
    }

    $version = $argv[1];
}

try {
    if (! PhpEndOfLife::isSupported($version)) {
        // Not Supported!
        exit(1);
    }
} catch (Exception $e) {
    exit(printPhpEndOfLifeError($e));
}
